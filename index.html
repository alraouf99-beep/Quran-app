<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø§ÙƒÙŠ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¯ÙˆØ§Ù…Ø© - Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„ØªØªØ§Ø¨Ø¹ÙŠ</title>
    <style>
        :root { --p: #004d40; --g: #c09b52; --bg: #f8faf9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 15px; text-align: center; }
        .vortex-container { max-width: 650px; margin: auto; background: white; padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 8px solid var(--p); }
        .logic-box { background: #e0f2f1; padding: 12px; border-radius: 10px; font-size: 13px; margin-bottom: 20px; text-align: right; line-height: 1.6; border-right: 5px solid var(--g); }
        .input-group { text-align: right; margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: var(--p); }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
        .flex { display: flex; gap: 10px; }
        button { width: 100%; background: var(--p); color: white; padding: 18px; border: none; border-radius: 15px; font-size: 20px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #00695c; }
        #result { margin-top: 25px; padding: 20px; border: 2px solid var(--g); border-radius: 15px; display: none; background: #fff; text-align: right; }
        .res-line { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .val { font-weight: bold; color: #2e7d32; font-size: 1.1em; }
        .flow-info { font-size: 12px; color: #555; background: #fff8e1; padding: 8px; border-radius: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="vortex-container">
    <h2>Ù…Ø­Ø§ÙƒÙŠ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¯ÙˆØ§Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ</h2>
    <div class="logic-box">
        â€¢ <b>Ø§Ù„ØªØ¯ÙÙ‚:</b> ØªØ¨Ø¯Ø£ Ø§Ù„Ø¯ÙˆØ§Ù…Ø© Ø¨Ø§Ù„Ø²ÙˆØ¬Ø©ØŒ Ø«Ù… Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ† (Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„ÙˆØµÙŠØ©)ØŒ Ø«Ù… Ø§Ù„ÙˆÙ„Ø¯/Ø§Ù„Ø¥Ø®ÙˆØ©.<br>
        â€¢ <b>Ø§Ù„ÙƒØªÙ„Ø© Ø§Ù„Ù…ØªÙ†Ø§Ù‚ØµØ©:</b> ÙƒÙ„ Ø·Ø±Ù ÙŠØ£Ø®Ø° Ù†Ø³Ø¨ØªÙ‡ Ù…Ù† "Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ" Ù…Ù…Ø§ Ù‚Ø¨Ù„Ù‡.<br>
        â€¢ <b>Ø§Ù„ÙƒÙ„Ø§Ù„Ø©:</b> ØºÙŠØ§Ø¨ Ø§Ù„Ø£Ø¨ ÙˆØ§Ù„Ø£Ù… ÙˆØ§Ù„ÙˆÙ„Ø¯ (Ø§Ù„Ø°ÙƒØ± ÙˆØ§Ù„Ø£Ù†Ø«Ù‰).
    </div>

    <div class="input-group">
        <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¨Ù„Øº Ø§Ù„ØªØ±ÙƒØ© (MAD):</label>
        <input type="number" id="estate" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" value="1000">
    </div>

    <div class="input-group">
        <label>Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± (Ø§Ù„Ø²ÙˆØ¬ÙŠØ©):</label>
        <select id="spouseExist">
            <option value="none">Ø£Ø¹Ø²Ø¨ / Ø¹Ø²Ø¨Ø§Ø¡</option>
            <option value="wife">Ø²ÙˆØ¬Ø©</option>
            <option value="husband">Ø²ÙˆØ¬</option>
        </select>
    </div>

    <div class="input-group">
        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ (Ø§Ù„ÙˆÙ„Ø¯):</label>
        <input type="number" id="totalChildren" value="0" min="0">
    </div>

    <div class="input-group">
        <label>Ø§Ù„Ø£Ø¨ÙˆØ§Ù†:</label>
        <div class="flex">
            <select id="father"><option value="0">Ø§Ù„Ø£Ø¨ Ù…ØªÙˆÙÙ‰</option><option value="1">Ø§Ù„Ø£Ø¨ Ø­ÙŠ</option></select>
            <select id="mother"><option value="0">Ø§Ù„Ø£Ù… Ù…ØªÙˆÙØ§Ø©</option><option value="1">Ø§Ù„Ø£Ù… Ø­ÙŠØ©</option></select>
        </div>
    </div>

    <div class="input-group">
        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø®ÙˆØ© (Ù„Ù„ÙƒÙ„Ø§Ù„Ø©):</label>
        <input type="number" id="totalSiblings" value="0" min="0">
    </div>

    <button onclick="runVortexFlow()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©</button>
    
    <div id="result"></div>
</div>

<script>
function runVortexFlow() {
    const estate = parseFloat(document.getElementById('estate').value);
    if (!estate) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº Ø§Ù„ØªØ±ÙƒØ©");

    const sp = document.getElementById('spouseExist').value;
    const nC = parseInt(document.getElementById('totalChildren').value) || 0;
    const hasF = document.getElementById('father').value === "1";
    const hasM = document.getElementById('mother').value === "1";
    const nS = parseInt(document.getElementById('totalSiblings').value) || 0;

    let currentBalance = estate;
    let finalShares = {};
    let steps = "";

    // 1. Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø²ÙˆØ¬Ø©/Ø§Ù„Ø²ÙˆØ¬ (Ø¢ÙŠØ© 12) Ù…Ù† Ø£ØµÙ„ Ø§Ù„ØªØ±ÙƒØ©
    let sRate = 0;
    if (sp === 'wife') sRate = (nC > 0) ? 1/8 : 1/4;
    else if (sp === 'husband') sRate = (nC > 0) ? 1/4 : 1/2;

    if (sRate > 0) {
        finalShares.spouse = estate * sRate;
        currentBalance -= finalShares.spouse;
        steps += `â€¢ ØªÙ… Ø§Ø³ØªÙ‚Ø·Ø§Ø¹ Ù†ØµÙŠØ¨ Ø§Ù„Ø²ÙˆØ¬ÙŠØ© Ù…Ù† Ø§Ù„Ø£ØµÙ„.<br>`;
    }

    // 2. Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„ÙˆØ§Ù„Ø¯Ø§Ù† (Ø¢ÙŠØ© 11) Ù…Ù† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„ÙˆØµÙŠØ©)
    const isKhalala = !hasF && !hasM && nC === 0;
    if (!isKhalala) {
        if (hasM) {
            let mRate = (nC > 0 || nS >= 2) ? 1/6 : 1/3;
            finalShares.mother = currentBalance * mRate;
        }
        if (hasF) {
            let fRate = 1/6;
            finalShares.father = currentBalance * fRate;
        }
        currentBalance -= (finalShares.mother || 0) + (finalShares.father || 0);
        steps += `â€¢ ØªÙ… ØªÙˆØ²ÙŠØ¹ Ù†ØµÙŠØ¨ Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ† Ù…Ù† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø²ÙˆØ¬Ø©.<br>`;
    }

    // 3. Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø§Ù„ÙˆÙ„Ø¯ Ø£Ùˆ Ø§Ù„Ø¥Ø®ÙˆØ© (Ù‚Ø§Ø¹ Ø§Ù„Ø¯ÙˆØ§Ù…Ø©)
    if (nC > 0) {
        finalShares.children = currentBalance; // Ø§Ù„ÙˆÙ„Ø¯ ÙŠØ£Ø®Ø° ÙƒÙ„ Ù…Ø§ Ø§Ø³ØªÙ‚Ø± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹
        steps += `â€¢ Ø§Ø³ØªÙ‚Ø± Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªØ±ÙƒØ© Ø¹Ù†Ø¯ Ø§Ù„Ø£ÙˆÙ„Ø§Ø¯.<br>`;
    } else if (isKhalala && nS > 0) {
        // ØªØ·Ø¨ÙŠÙ‚ Ø¢ÙŠØ© 12 Ù„Ù„ÙƒÙ„Ø§Ù„Ø©: Ø§Ù„Ø³Ø¯Ø³ Ù„Ù„ÙˆØ§Ø­Ø¯ ÙˆØ§Ù„Ø«Ù„Ø« Ù„Ù„Ø¬Ù…Ø¹ Ù…Ù† "Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ"
        let sibRate = (nS === 1) ? 1/6 : 1/3;
        let sibAmount = currentBalance * sibRate;
        finalShares.siblings = sibAmount;
        
        // Ø§Ù„ÙØ§Ø¦Ø¶ Ø¨Ø¹Ø¯ Ø§Ù„ÙƒÙ„Ø§Ù„Ø© ÙŠÙØ±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬Ø© (Ø§Ù„Ø£Ù‚Ø±Ø¨ÙˆÙ†)
        let surplus = currentBalance - sibAmount;
        if (surplus > 0 && sp !== 'none') {
            finalShares.spouse += surplus;
            steps += `â€¢ ØªÙ… Ø±Ø¯ ÙØ§Ø¦Ø¶ Ø§Ù„ÙƒÙ„Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø²ÙˆØ¬Ø©.<br>`;
        }
    } else if (currentBalance > 0) {
        // Ø±Ø¯ Ø¹Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ† Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ ÙˆÙ„Ø¯ Ø£Ùˆ Ø¥Ø®ÙˆØ©
        if (sp !== 'none') finalShares.spouse = (finalShares.spouse || 0) + currentBalance;
        else if (hasM) finalShares.mother += currentBalance;
        steps += `â€¢ ØªÙ… Ø±Ø¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø±Ø¨ÙˆÙ†.<br>`;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    let html = `<h4>${isKhalala ? "âš ï¸ Ø­Ø§Ù„Ø© ÙƒÙ„Ø§Ù„Ø©" : "ğŸ“‹ Ø­Ø§Ù„Ø© ØªØ¯ÙÙ‚ Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©"}</h4>`;
    html += `<div class="flow-info">${steps}</div>`;
    
    if (finalShares.spouse) html += line("Ø§Ù„Ø²ÙˆØ¬/Ø© (Ø´Ø§Ù…Ù„ Ø§Ù„Ø±Ø¯)", finalShares.spouse);
    if (hasM) html += line("Ø§Ù„Ø£Ù…", finalShares.mother);
    if (hasF) html += line("Ø§Ù„Ø£Ø¨", finalShares.father);
    if (finalShares.children) html += line("Ø§Ù„Ø£ÙˆÙ„Ø§Ø¯", finalShares.children);
    if (finalShares.siblings) html += line("Ø§Ù„Ø¥Ø®ÙˆØ©", finalShares.siblings);

    document.getElementById('result').innerHTML = html;
    document.getElementById('result').style.display = 'block';
}

function line(label, val) {
    return `<div class="res-line"><span>${label}:</span> <span class="val">${val.toLocaleString(undefined, {maximumFractionDigits: 2})} MAD</span></div>`;
}
</script>

</body>
</html>


